FROM golang:1.13 AS backend

# make the 'app' folder the current working directory
WORKDIR /app
RUN mkdir /builds

# Copy module files and build script
ADD go.mod .
ADD go.sum .
ADD DeimosC2_Package.py .

# install project dependencies
RUN go mod download

# Copy Deimos files
ADD /c2 c2
ADD /agents agents
ADD /archives archives
ADD /droppers droppers
ADD /lib lib
ADD /modules modules
ADD /resources resources

ARG GOOS linux
ARG GOARCH amd64
ENV GOOS=${GOOS}
ENV GOARCH=${GOARCH}

RUN env GOOS=darwin GOARCH=amd64 go build --ldflags="-s -w" -trimpath -o /builds/test3.exe ./c2/main.go


# build app for production with minification
# RUN npm run build

CMD [ "bash" ]
